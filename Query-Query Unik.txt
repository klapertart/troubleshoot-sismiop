
>> Select NOP-NOP dengan SUBJEK_PAJAK_ID yang sama

SELECT KD_PROPINSI, KD_DATI2, KD_KECAMATAN, KD_KELURAHAN, KD_BLOK, NO_URUT, SUBJEK_PAJAK_ID
FROM DAT_OBJEK_PAJAK
GROUP BY SUBJEK_PAJAK_ID, KD_PROPINSI,KD_DATI2, KD_KECAMATAN, KD_KELURAHAN, KD_BLOK, NO_URUT
HAVING COUNT(SUBJEK_PAJAK_ID) > 1 


>> Select Dengan kolom-kolom per tahun
select A.NM_WP_SPPT NAMA,A.KD_PROPINSI||A.KD_DATI2||A.KD_KECAMATAN||A.KD_KELURAHAN||A.KD_BLOK||A.NO_URUT||A.KD_JNS_OP NOP,A.JLN_WP_SPPT ALAMAT,                 
  max(case when A.THN_PAJAK_SPPT = '2009' then A.STATUS_PEMBAYARAN_SPPT end)tahun_2009,
  max(case when A.THN_PAJAK_SPPT = '2010' then A.STATUS_PEMBAYARAN_SPPT end) tahun_2010,
  max(case when A.THN_PAJAK_SPPT = '2011' then A.STATUS_PEMBAYARAN_SPPT end) tahun_2011,
  max(case when A.THN_PAJAK_SPPT = '2012' then A.STATUS_PEMBAYARAN_SPPT end) tahun_2012,
  max(case when A.THN_PAJAK_SPPT = '2013' then A.STATUS_PEMBAYARAN_SPPT end) tahun_2013,
  max(case when A.THN_PAJAK_SPPT = '2014' then A.STATUS_PEMBAYARAN_SPPT end) tahun_2014,
  max(case when A.THN_PAJAK_SPPT = '2015' then A.STATUS_PEMBAYARAN_SPPT end) tahun_2015
from SPPT A join 
PEMBAYARAN_SPPT B 
ON(A.KD_PROPINSI||A.KD_DATI2||A.KD_KECAMATAN||A.KD_KELURAHAN||A.KD_BLOK||A.NO_URUT||A.KD_JNS_OP=
 B.KD_PROPINSI||B.KD_DATI2||B.KD_KECAMATAN||B.KD_KELURAHAN||B.KD_BLOK||B.NO_URUT||B.KD_JNS_OP)
group by A.NM_WP_SPPT,A.KD_PROPINSI||A.KD_DATI2||A.KD_KECAMATAN||A.KD_KELURAHAN||A.KD_BLOK||A.NO_URUT||A.KD_JNS_OP,A.JLN_WP_SPPT;



>> Select realisasi SPPT, Pokok, dan tunggakan

SELECT A.KD_PROPINSI, A.KD_DATI2, 
A.KD_KECAMATAN, A.KD_KELURAHAN, B.NM_KECAMATAN, C.NM_KELURAHAN, 
COUNT(CASE WHEN A.STATUS_PEMBAYARAN_SPPT <> '2' THEN 1 END) POKOK_SPPT,
SUM (CASE WHEN A.STATUS_PEMBAYARAN_SPPT <> '2' THEN A.PBB_YG_HARUS_DIBAYAR_SPPT END) POKOK_JML,
COUNT(CASE WHEN A.STATUS_PEMBAYARAN_SPPT = '1' THEN 1 END) REALISASI_SPPT,
SUM (CASE WHEN A.STATUS_PEMBAYARAN_SPPT = '1' THEN A.PBB_YG_HARUS_DIBAYAR_SPPT END) REALISASI_JML,
COUNT(CASE WHEN A.STATUS_PEMBAYARAN_SPPT = '0' THEN 1 END) SISA_SPPT,
SUM (CASE WHEN A.STATUS_PEMBAYARAN_SPPT = '0' THEN A.PBB_YG_HARUS_DIBAYAR_SPPT END) SISA_JML
FROM SPPT A, REF_KECAMATAN B, REF_KELURAHAN C
WHERE 
A.KD_PROPINSI = B.KD_PROPINSI AND
A.KD_DATI2 = B.KD_DATI2 AND
A.KD_KECAMATAN = B.KD_KECAMATAN AND
A.KD_PROPINSI = C.KD_PROPINSI AND
A.KD_DATI2 = C.KD_DATI2 AND
A.KD_KECAMATAN = C.KD_KECAMATAN AND
A.KD_KELURAHAN = C.KD_KELURAHAN AND
A.THN_PAJAK_SPPT = '2013' AND
A.PBB_YG_HARUS_DIBAYAR_SPPT between 0 and 999999999999999
GROUP BY  A.KD_PROPINSI, A.KD_DATI2, 
A.KD_KECAMATAN, A.KD_KELURAHAN,B.NM_KECAMATAN, C.NM_KELURAHAN
ORDER BY B.NM_KECAMATAN, C.NM_KELURAHAN ASC


>> Query mencari NOP yang sudah bayar, tetapi status pembayaran di SPPT masih 0
SELECT KD_PROPINSI, KD_DATI2, KD_KECAMATAN, KD_KELURAHAN, KD_BLOK, NO_URUT, KD_JNS_OP, THN_PAJAK_SPPT
FROM PEMBAYARAN_SPPT
WHERE
THN_PAJAK_SPPT = '2009' AND
KD_PROPINSI||KD_DATI2||KD_KECAMATAN||KD_KELURAHAN||KD_BLOK||NO_URUT||KD_JNS_OP IN (
SELECT KD_PROPINSI||KD_DATI2||KD_KECAMATAN||KD_KELURAHAN||KD_BLOK||NO_URUT||KD_JNS_OP
FROM SPPT
WHERE 
KD_PROPINSI = '16' AND
KD_DATI2 = '09' AND
KD_KECAMATAN = '050' AND
THN_PAJAK_SPPT = '2009' AND
STATUS_PEMBAYARAN_SPPT = '0'
)


* sesuaikan tahun pajaknya
* query diatas masih dalam lingkup kecamatan, jika ingin lingkup kelurahan tinggal tambahkan kode kelurahan.


>> Query ekstrak data ZNT
SELECT A.KD_PROPINSI||A.KD_DATI2||A.KD_KECAMATAN||A.KD_KELURAHAN||A.KD_BLOK||A.NO_URUT||A.KD_JNS_OP,
B.NM_KECAMATAN, C.NM_KELURAHAN, A.KD_ZNT, D.NIR
FROM DAT_OP_BUMI A, REF_KECAMATAN B, REF_KELURAHAN C, DAT_NIR D
WHERE
A.KD_PROPINSI = B.KD_PROPINSI AND
A.KD_DATI2 = B.KD_DATI2 AND
A.KD_KECAMATAN = B.KD_KECAMATAN AND
A.KD_PROPINSI = C.KD_PROPINSI AND
A.KD_DATI2 = C.KD_DATI2 AND
A.KD_KECAMATAN = C.KD_KECAMATAN AND
A.KD_KELURAHAN = C.KD_KELURAHAN AND
A.KD_PROPINSI = D.KD_PROPINSI AND
A.KD_DATI2 = D.KD_DATI2 AND
A.KD_KECAMATAN = D.KD_KECAMATAN AND
A.KD_KELURAHAN = D.KD_KELURAHAN AND
A.KD_ZNT = D.KD_ZNT
GROUP BY A.KD_PROPINSI||A.KD_DATI2||A.KD_KECAMATAN||A.KD_KELURAHAN||A.KD_BLOK||A.NO_URUT||A.KD_JNS_OP,
A.KD_ZNT, B.NM_KECAMATAN, C.NM_KELURAHAN, D.NIR;

>> Query date
SELECT * FROM PEMBAYARAN_SPPT
WHERE TRUNC(TGL_PEMBAYARAN_SPPT) = TO_DATE('29/02/2016','dd/mm/yyyy');

>> Delete record
DELETE CPPMOD_PBB_WAJIB_PAJAK, WP_MIGRASI
FROM CPPMOD_PBB_WAJIB_PAJAK
INNER JOIN WP_MIGRASI
ON WP_MIGRASI.WP_ID = CPPMOD_PBB_WAJIB_PAJAK.CPM_WP_ID


>> Query data sppt yang sudah bayar (dicek join di sppt dengan pembayaran_sppt)

SELECT
A.KD_PROPINSI||A.KD_DATI2||A.KD_KECAMATAN||A.KD_KELURAHAN||A.KD_BLOK||A.NO_URUT||A.KD_JNS_OP,
A.NM_WP_SPPT, A.LUAS_BUMI_SPPT, A.LUAS_BNG_SPPT, A.PBB_YG_HARUS_DIBAYAR_SPPT, A.THN_PAJAK_SPPT
FROM SPPT A, PEMBAYARAN_SPPT B
WHERE
A.KD_PROPINSI = B.KD_PROPINSI AND
A.KD_DATI2 = B.KD_DATI2 AND
A.KD_KECAMATAN = B.KD_KECAMATAN AND
A.KD_KELURAHAN = B.KD_KELURAHAN AND
A.KD_BLOK = B.KD_BLOK AND
A.NO_URUT = B.NO_URUT AND
A.KD_JNS_OP = B.KD_JNS_OP AND
A.THN_PAJAK_SPPT = B.THN_PAJAK_SPPT AND
A.STATUS_PEMBAYARAN_SPPT = '1' AND
A.THN_PAJAK_SPPT = '2014' AND
TRUNC(B.TGL_PEMBAYARAN_SPPT) BETWEEN TO_DATE('01/01/2014','dd/mm/yyyy') AND TO_DATE('31/12/2014','dd/mm/yyyy')
ORDER BY A.KD_PROPINSI||A.KD_DATI2||A.KD_KECAMATAN||A.KD_KELURAHAN||A.KD_BLOK||A.NO_URUT||A.KD_JNS_OP ASC;



>> QUERY DATE BETWEEN

SELECT TGL_PEMBAYARAN_SPPT FROM PEMBAYARAN_SPPT
WHERE TRUNC(TGL_PEMBAYARAN_SPPT) BETWEEN TO_DATE('01/02/2016','dd/mm/yyyy') AND TO_DATE('29/02/2016','dd/mm/yyyy')
ORDER BY TGL_PEMBAYARAN_SPPT DESC;


>> QUERY TOTAL LUAS DAN NJOP BANGUNAN PER-JENIS BANGUNAN

SELECT 
B.KD_JPB,
SUM (CASE WHEN A.THN_PAJAK_SPPT = '2016' THEN A.LUAS_BNG_SPPT END) AS LUAS_BNG_2016,
SUM (CASE WHEN A.THN_PAJAK_SPPT = '2017' THEN A.LUAS_BNG_SPPT END) AS LUAS_BNG_2017,
SUM (CASE WHEN A.THN_PAJAK_SPPT = '2016' THEN A.NJOP_BNG_SPPT END) AS LUAS_BNG_2016,
SUM (CASE WHEN A.THN_PAJAK_SPPT = '2017' THEN A.NJOP_BNG_SPPT END) AS LUAS_BNG_2017
FROM SPPT A, DAT_OP_BANGUNAN B
WHERE
A.KD_PROPINSI = B.KD_PROPINSI AND
A.KD_DATI2 = B.KD_DATI2 AND
A.KD_KECAMATAN = B.KD_KECAMATAN AND
A.KD_KELURAHAN = B.KD_KELURAHAN AND
A.KD_BLOK = B.KD_KELURAHAN AND
A.NO_URUT = B.NO_URUT AND
A.KD_JNS_OP = B.KD_JNS_OP AND
A.THN_PAJAK_SPPT BETWEEN '2016' AND '2017'
GROUP BY B.KD_JPB
ORDER BY B.KD_JPB


>> QUERY DUPLICATE FIELD WITH TRIM

SELECT DISTINCT(TRIM(BOTH ' ' FROM SUBJEK_PAJAK_ID)), COUNT(*)
FROM DAT_SUBJEK_PAJAK
GROUP BY TRIM(BOTH ' ' FROM SUBJEK_PAJAK_ID)
HAVING COUNT(*) > 1


>> COUNT Data Tagihan SISMIOP to PBBWEB

SELECT COUNT(*) FROM SPPT A LEFT JOIN 
                    (
                    SELECT * FROM PEMBAYARAN_SPPT B 
                    WHERE   
                        B.PEMBAYARAN_SPPT_KE=(
                        SELECT MAX(Z.PEMBAYARAN_SPPT_KE) 
                        FROM PEMBAYARAN_SPPT Z 
                        WHERE B.KD_PROPINSI=Z.KD_PROPINSI AND B.KD_DATI2=Z.KD_DATI2 AND B.KD_KECAMATAN=Z.KD_KECAMATAN 
                            AND B.KD_KELURAHAN=Z.KD_KELURAHAN AND B.KD_BLOK=Z.KD_BLOK AND B.NO_URUT=Z.NO_URUT 
                            AND B.KD_JNS_OP=Z.KD_JNS_OP 
                            AND B.THN_PAJAK_SPPT=Z.THN_PAJAK_SPPT 
                        GROUP BY Z.KD_PROPINSI, Z.KD_DATI2, Z.KD_KECAMATAN, Z.KD_KELURAHAN, Z.KD_BLOK, Z.NO_URUT, Z.KD_JNS_OP, Z.THN_PAJAK_SPPT 
                        )
                    )B 
                    ON 
                        A.KD_PROPINSI=B.KD_PROPINSI AND A.KD_DATI2=B.KD_DATI2 AND A.KD_KECAMATAN=B.KD_KECAMATAN AND A.KD_KELURAHAN=B.KD_KELURAHAN AND A.KD_BLOK=B.KD_BLOK AND A.NO_URUT=B.NO_URUT AND A.KD_JNS_OP=B.KD_JNS_OP 
                        AND A.THN_PAJAK_SPPT=B.THN_PAJAK_SPPT 
                     LEFT JOIN DAT_OBJEK_PAJAK C 
                    ON 
                        A.KD_PROPINSI=C.KD_PROPINSI AND A.KD_DATI2=C.KD_DATI2 AND A.KD_KECAMATAN=C.KD_KECAMATAN AND A.KD_KELURAHAN=C.KD_KELURAHAN AND A.KD_BLOK=C.KD_BLOK AND A.NO_URUT=C.NO_URUT AND A.KD_JNS_OP=C.KD_JNS_OP
